è¿™ä¸€èŠ‚æˆ‘ä»¬å®ç° useReducer å’Œ useStateï¼Œè®©å‡½æ•°ç»„ä»¶æ”¯æŒæ•°æ®æ›´æ–°ã€‚
> [ğŸ‘‰ ä»“åº“åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fjerry-lllman%2Fmini-react)ï¼Œè·ªæ±‚æ‚¨å¸®å¿™ç‚¹ä¸ª ğŸŒŸğŸŒŸï¼Œè°¢è°¢å•¦ï½
> PSï¼šæœ¬èŠ‚ä»£ç åœ¨ v0.0.3 åˆ†æ”¯

## ä½¿ç”¨ useReducer
åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦åœ¨`demo/which-react.js`ä¸­å°†`useReducer`ä»reactä¸­å¼•å…¥ï¼Œå¹¶å°†`ReactDOM`æ›´æ¢ä¸ºä»`react-dom`å¼•å…¥

```javascript
import { Component, Fragment, useReducer } from 'react';
import ReactDOM from 'react-dom/client';

// import { Component, Fragment } from '../src/react';
// import ReactDOM from '../src/react-dom';

export {
	Component,
	Fragment,
	useReducer,
	ReactDOM
}
```

åœ¨`demo/src/main.jsx`ä¸­çš„ FunctionComponent ä¸­æ·»åŠ `useReducer`

```tsx
function FunctionComponent(props) {

  const [state, dispatch] = useReducer(x => x + 1, 0)

  return (
    <div className='function'>
      <p>{props.name}</p>
      <div>{state}</div>
      <button onClick={dispatch} >+1</button>
    </div>
  )
}
```
é‚£ä¹ˆæ¯æ¬¡ç‚¹å‡»`button`éƒ½ä¼šå°†`state` + 1ï¼Œæœ‰äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»å®ç°å®ƒ
## å®ç° useReducer
å°† React çš„å¼•å…¥é‡æ–°è®¾å®šä¸ºè‡ªå·±å†™çš„ï¼ˆä¿®æ”¹which-react.jsï¼‰ï¼Œåˆ›å»º`src/ReactFiberHooks.ts`
```typescript
export function useReducer(reducer, initalState) {
	
	const dispatch = () => {
		console.log('useReducer dispatch log')
	}
	// æš‚æ—¶ç›´æ¥è¿”å›
	return [initalState, dispatch]
}
```
æ¥ç€ä¼šå‘ç°ç‚¹å‡» button æ²¡æœ‰è§¦å‘ dispatch é‡Œçš„ consoleï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç° React äº‹ä»¶ï¼Œæš‚æ—¶åªæ˜¯å°†äº‹ä»¶ä½œä¸ºå±æ€§æŒ‚åœ¨domä¸Š
```typescript
// src/utils.ts
export function updateNode(node, nextVal) {
  Object.keys(nextVal).forEach(key => {
    if (key === 'children') {
      if (isStringOrNumber(nextVal[key])) {
        node.textContent = nextVal[key]
      }
    } else {
      node[key] = nextVal[key] // è¿™é‡Œç›´æ¥å½“ä½œå±æ€§æ”¾åˆ° dom ä¸Šäº†
    }
  })
}
```
è¿™é‡Œæˆ‘ä»¬å…ˆç®€å•å¤„ç†ä¸€ä¸‹ï¼Œèƒ½è®©äº‹ä»¶èƒ½å“åº”ï¼ˆæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯çœŸæ­£çš„ React äº‹ä»¶å®ç°æ–¹å¼ï¼‰
```typescript
export function updateNode(node: HTMLElement, nextVal) {
  Object.keys(nextVal).forEach(key => {
    if (key === 'children') {
      if (isStringOrNumber(nextVal[key])) {
        node.textContent = nextVal[key]
      }
    } else if (key.slice(0, 2) === 'on') {
      // ç®€å•å¤„ç†ä¸€ä¸‹äº‹ä»¶å“åº”ï¼ˆå¹¶ä¸æ˜¯çœŸæ­£çš„React äº‹ä»¶ï¼‰
      const eventName = key.slice(2).toLocaleLowerCase()
      node.addEventListener(eventName, nextVal[key])
    } else {
      node[key] = nextVal[key]
    }
  })
}
```
ç‚¹å‡»æŒ‰é’®èƒ½è®©`console.log('useReducer dispatch log')`æ‰§è¡Œå‡ºæ¥äº†
### å®ç° mount æ—¶çš„ useReducer
```typescript
import { Fiber } from "./ReactFiber"

interface Hook {
	memoizedState: any, // state
	next: null | Hook // ä¸‹ä¸€ä¸ª hook
}

// å½“å‰æ­£åœ¨æ¸²æŸ“çš„ fiber
let currentlyRenderingFiber: Fiber | null = null

// æ²¡ä»€ä¹ˆç‰¹åˆ«çš„æ„ä¹‰ï¼Œå°±æ˜¯æƒ³è¿”å›ä¸€ä¸ª Fiber ç±»å‹ ä¸è®© ts æŠ¥é”™
function getCurrentlyRenderingFiber() {
	return currentlyRenderingFiber as Fiber
}

// å½“å‰æ­£åœ¨å¤„ç†çš„ hook
let workInProgressHook: Hook | null = null

export function renderWithHooks(workInProgress: Fiber) {
	currentlyRenderingFiber = workInProgress
	currentlyRenderingFiber.memoizedState = null
	workInProgressHook = null
}

function updateWorkInProgressHook() {
	currentlyRenderingFiber = getCurrentlyRenderingFiber()
	let hook

	const current = currentlyRenderingFiber.alternate
	// current å­˜åœ¨è¯´æ˜æ˜¯ updateï¼Œå¦åˆ™å°±æ˜¯ mount
	if (current) {
		// å¤ç”¨ä¹‹å‰çš„ hook
		currentlyRenderingFiber.memoizedState = current.memoizedState
		// çœ‹æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ª hook
		if (workInProgressHook) {
			// ä¸æ˜¯ï¼Œåˆ™æ‹¿åˆ°ä¸‹ä¸€ä¸ª hookï¼ŒåŒæ—¶æ›´æ–° workInProgressHook
			workInProgressHook = hook = workInProgressHook.next
		} else {
			// æ˜¯ç¬¬ä¸€ä¸ª hook ï¼Œæ‹¿åˆ°ç¬¬ä¸€ä¸ªhook
			workInProgressHook = hook = currentlyRenderingFiber.memoizedState
		}
	} else {
		// mount æ—¶éœ€è¦æ–°å»ºhook
		hook = {
			memoizedState: null, // state
			next: null // ä¸‹ä¸€ä¸ª hook
		}
		if (workInProgressHook) {
			workInProgressHook = workInProgressHook.next = hook
		} else {
			// ç¬¬ä¸€ä¸ª hookï¼Œå°† hook æ”¾åˆ° fiber çš„ state ä¸Šï¼ŒåŒæ—¶æ›´æ–° workInProgressHook
			workInProgressHook = currentlyRenderingFiber.memoizedState = hook
		}
	}
	// æœ€ç»ˆè¿”å› hookï¼ˆä¹Ÿå°±æ˜¯ workInProgressHookï¼‰
	return hook
}

export function useReducer(reducer, initalState) {
	currentlyRenderingFiber = getCurrentlyRenderingFiber()

	const hook = updateWorkInProgressHook()

	if (!currentlyRenderingFiber.alternate) {
		// åˆæ¬¡æ¸²æŸ“æ—¶å°†é»˜è®¤æ•°æ®æ”¾åˆ° hook.memoizedState ä¸Šå³å¯
		hook.memoizedState = initalState
	}

	const dispatch = () => {
		console.log('useReducer dispatch log')
	}

  // è¿”å› state
	return [hook.memoizedState, dispatch]
}
```

åœ¨å¤„ç† FunctionComponent æ—¶æ›´æ–°æ­£åœ¨å¤„ç†çš„ fiberï¼ˆä¹Ÿå°±æ˜¯å½“å‰çš„è¿™ä¸ªå‡½æ•°ï¼‰
```typescript
// ReactFiberReconciler.ts
export function updateFunctionComponent(workInProgress: Fiber) {
	// æ›´æ–°æ­£åœ¨å¤„ç†çš„ fiber
	renderWithHooks(workInProgress)
	const { type, props } = workInProgress
	const children = type(props)
	reconcileChildren(workInProgress, children)
}
```
### å®ç° update æ—¶çš„ useReducer
ç°åœ¨é¡µé¢åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“æ­£å¸¸ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œç‚¹å‡»æŒ‰é’®è¿˜åªæ˜¯consoleï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç† update æ—¶ã€‚
update æ—¶éœ€è¦è®©æ•°æ®æ›´æ–°ï¼ˆé¡µé¢æ›´æ–°ï¼‰ï¼Œä¹‹å‰æ˜¯é€šè¿‡è°ƒ`scheduleUpdateOnFiber`è¿›è¡Œæ›´æ–°ï¼Œè¿™é‡Œä¹Ÿéœ€è¦ä½¿ç”¨

```typescript
export function useReducer(reducer, initalState) {

	const hook = updateWorkInProgressHook()

	if (!currentlyRenderingFiber?.alternate) {
		// åˆæ¬¡æ¸²æŸ“
		hook.memoizedState = initalState
	}

	const dispatch = () => {
		// ä¿®æ”¹çŠ¶æ€å€¼(å°†æ—§çš„stateä¼ ç»™ä½¿ç”¨è€…ï¼Œç„¶åè¿”å›æ–°çš„stateç»™ hook)
		hook.memoizedState = reducer(hook.memoizedState); // åé¢æœ‰åœ†æ‹¬å·ï¼Œéœ€è¦åŠ åˆ†å·

		// æ›´æ–°ä¹‹å‰å°† currentlyRenderingFiber è®¾ç½®ä¸ºè‡ªå·±çš„ alternate 
		(currentlyRenderingFiber as Fiber).alternate = { ...currentlyRenderingFiber as Fiber }
		// æ›´æ–°
		scheduleUpdateOnFiber(currentlyRenderingFiber as Fiber)
		console.log('useReducer dispatch log')
	}
	
	return [hook.memoizedState, dispatch]
}
```

å› ä¸ºæˆ‘ä»¬å†™çš„ FragmentComponent ä¹Ÿæ˜¯ `FunctionComponent`æ‰€ä»¥åœ¨ mount å®Œä»¥å Â  `currentlyReeringFiber` å°±æŒ‡å‘äº†è¿™ä¸ª FragmentComponentï¼Œè¿™é‡Œå…ˆä¿è¯å†™çš„æœ€åä¸€ä¸ª FunctionComponent æ˜¯åŒ…å«æœ‰åˆšåˆšå†™çš„ useReducer çš„ç»„ä»¶ï¼Œå°†å…¶ä»–ç»„ä»¶éƒ½æ³¨è§†æ‰ï¼Œæœ‰å…¶ä»–é—®é¢˜åé¢å†å¤„ç†ã€‚

åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»ä»¥åé¡µé¢ä»è¿™ä¸ª FunctionComponent å¾€åçš„ç»„ä»¶éƒ½ä¼šå†å‡ºç°ä¸€éï¼ŒåŒæ—¶ state æ˜¯æœ€æ–°çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ reconcileChildren æ—¶åˆ›å»ºçš„Fiberçš„ flags æ˜¯ Placementï¼Œæ¯æ¬¡éƒ½ä¼šé‡æ–°åˆ›å»ºæ–°çš„ dom

## å®ç°èŠ‚ç‚¹çš„å¤ç”¨
å› ä¸ºdiffæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬è¿™èŠ‚çš„é‡ç‚¹æ˜¯å®ç°useReducerï¼Œæ‰€ä»¥åªä¼šå®ç°ä¸€ä¸ªç®€å•çš„diffï¼ˆsameNode å‡½æ•°åˆ¤æ–­èƒ½å¦å¤ç”¨ï¼‰
```typescript

function reconcileChildren(workInProgress: Fiber, children) {
	if (isStringOrNumber(children)) {

		return
	}
	// è¿™é‡Œå…ˆå°†å­èŠ‚ç‚¹éƒ½å½“ä½œæ•°ç»„æ¥å¤„ç†
	const newChildren: any[] = isArray(children) ? children : [children]

	// oldFiber çš„å¤´èŠ‚ç‚¹
	let oldFiber = workInProgress.alternate?.child
	// ç”¨äºä¿å­˜ä¸Šä¸ª fiber èŠ‚ç‚¹
	let previousNewFiber: Fiber | null = null
	for (let i = 0; i < newChildren.length; i++) {
		const newChild = newChildren[i]
		if (newChild === null) {
			// ä¼šé‡åˆ° null çš„èŠ‚ç‚¹ï¼Œç›´æ¥å¿½ç•¥å³å¯
			continue
		}
		const newFiber = createFiber(newChild, workInProgress)
		// èƒ½å¦å¤ç”¨
		const same = sameNode(newFiber, oldFiber)

		if (same) {
			// èƒ½å¤ç”¨
			Object.assign(newFiber, {
				stateNode: (oldFiber as Fiber).stateNode,
				alternate: oldFiber as Fiber,
				flags: Update
			})
		}

		if (oldFiber) {
			// å¤„äºfor ä¸­ï¼ŒoldFiber ä¹Ÿéœ€è¦æ›´æ–°åˆ°ä¸‹ä¸€ä¸ª fiber	
			oldFiber = oldFiber.sibling
		}

		if (previousNewFiber === null) {
			// ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ç›´æ¥ä¿å­˜åˆ° workInProgress ä¸Š
			workInProgress.child = newFiber
		} else {
			// åç»­éƒ½ä¿å­˜åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ sibling ä¸Š
			previousNewFiber.sibling = newFiber
		}
		// æ›´æ–°
		previousNewFiber = newFiber
	}
}

// èŠ‚ç‚¹å¤ç”¨æ¡ä»¶
// 1. åŒå±‚çº§
// 2. type ç›¸åŒ
// 3. key ç›¸åŒ
function sameNode(a, b) {
	return a && b && a.type === b.type && a.key === b.key
}
```

æ¥ç€åœ¨ commit æ—¶éœ€è¦å¤„ç†èŠ‚ç‚¹æ›´æ–°æ—¶çš„æƒ…å†µ
```typescript
// ReactFIberWorkLoop.ts
function commitWorker(workInProgress: Fiber | null) {
  // ......
	if (flags & Update && stateNode) {
		// æ›´æ–°å±æ€§
		updateNode(
      stateNode, 
      (workInProgress.alternate as Fiber).props, 
      workInProgress.props
    )
	}

  // ......
}
```

åœ¨`updateNode`å‡½æ•°ä¸­éœ€è¦å°†æ—§çš„å±æ€§å’ŒåŸæœ¬ç›‘å¬çš„äº‹ä»¶éƒ½ç§»é™¤æ‰ï¼Œé‡æ–°èµ‹å€¼æ–°çš„å±æ€§å’Œç›‘å¬äº‹ä»¶
```typescript
// src/utils.ts
export function updateNode(node: HTMLElement, prevVal, nextVal) {
  // éå†è€çš„propsï¼Œå°†åŸæœ¬çš„äº‹ä»¶ä»¥åŠæ–°propsä¸å­˜åœ¨çš„å±æ€§ç§»é™¤
  Object.keys(prevVal)
    .forEach((key) => {
      if (key === "children") {
        // æœ‰å¯èƒ½æ˜¯æ–‡æœ¬ï¼Œç›´æ¥å°†å…¶æ¸…é™¤
        if (isStringOrNumber(prevVal[key])) {
          node.textContent = "";
        }
      } else if (key.slice(0, 2) === "on") {
        // äº‹ä»¶éœ€è¦ç§»é™¤æ‰
        const eventName = key.slice(2).toLocaleLowerCase();
        node.removeEventListener(eventName, prevVal[key]);
      } else {
        // å¯¹äºè€çš„keyå­˜åœ¨oldPropsï¼Œæ–°çš„ä¸Šé¢ä¸å­˜åœ¨çš„éœ€è¦å°†å…¶å¤„ç†æ‰ï¼ˆremoveï¼‰
        if (!(key in nextVal)) {
          node[key] = "";
        }
      }
    });

  // æ›´æ–° props
  Object.keys(nextVal)
    .forEach((key) => {
      if (key === "children") {
        // æœ‰å¯èƒ½æ˜¯æ–‡æœ¬
        if (isStringOrNumber(nextVal[key])) {
          node.textContent = nextVal[key] + "";
        }
      } else if (key.slice(0, 2) === "on") {
        const eventName = key.slice(2).toLocaleLowerCase();
        node.addEventListener(eventName, nextVal[key]);
      } else {
        node[key] = nextVal[key];
      }
    });
}
```

å‡½æ•°ç»„ä»¶çš„ useReducer å°±å®ç°äº†æ›´æ–°ã€‚ä½†è¿˜æœ‰ä¸€äº›éœ€è¦è§£å†³çš„bugã€‚

æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªFunctionComponentæ—¶ï¼Œä¼šå› ä¸º currntkyRendingFiber æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¯¼è‡´æœ€ç»ˆæŒ‡å‘çš„æ˜¯æœ€åä¸€ä¸ª FunctionComponentï¼Œä½¿å¾—æˆ‘ä»¬çš„ stateï¼Œæ— æ³•è¢«æ›´æ–°ï¼Œåè€Œå‡ºç°æœ€åä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“ä¸€æ¬¡é—®é¢˜ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯åœ¨ä½¿ç”¨ dispatch æ—¶å†…éƒ¨çš„ fiber æ˜¯å½“å‰ç»„ä»¶çš„ fiberã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ bind å¯ä»¥å­˜å‚¨ä½å‚æ•°çš„ç‰¹æ€§ï¼Œå°† currentlyRenderingFiber ä½œä¸º bind æ—¶çš„é¢„åˆ¶å‚æ•°ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨è°ƒç”¨ dispatch æ—¶æ‹¿åˆ°çš„ fiber æ˜¯ä½¿ç”¨è¿™ä¸ª hook çš„ fiberã€‚

```typescript
// src/ReactFiberHooks.ts

export function useReducer(reducer, initalState) {

	const hook = updateWorkInProgressHook()

	if (!(currentlyRenderingFiber as Fiber).alternate) {
		// åˆæ¬¡æ¸²æŸ“
		hook.memoizedState = initalState
	}

	// å› ä¸º currentlyRenderingFiber æ˜¯å…¨å±€å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å­˜å‚¨çš„ fiber ä¸æ˜¯éœ€è¦æ›´æ–° state çš„ fiber
	// æ‰€ä»¥éœ€è¦é€šè¿‡ bind åœ¨ dispatchReducerAction è¿™ä¸ªå‡½æ•°å†…å­˜å‚¨ä½ç›¸å…³ä¿¡æ¯ï¼ˆfiber ç­‰ï¼‰ï¼Œåœ¨è°ƒç”¨æ—¶èƒ½è·å–éœ€è¦æ›´æ–°çš„ fiber
	const dispatch = dispatchReducerAction.bind(
		null,
		currentlyRenderingFiber,
		hook,
		reducer
	)

	return [hook.memoizedState, dispatch]
}

function dispatchReducerAction(fiber: Fiber, hook: Hook, reducer, action) {
	hook.memoizedState = reducer(hook.memoizedState)
	// æ›´æ–°ä¹‹å‰å°† currentlyRenderingFiber è®¾ç½®ä¸ºè‡ªå·±çš„ alternate 
	fiber.alternate = { ...fiber }

	// æ›´æ–°
	scheduleUpdateOnFiber(fiber)
}
```

state ä¸æ›´æ–°çš„é—®é¢˜è§£å†³äº†ï¼Œè¿˜æœ‰ç»„ä»¶é‡æ–°æ¸²æŸ“çš„é—®é¢˜ã€‚è¿™ä¸ªå…¶å®ä¹Ÿå¾ˆç®€å•ã€‚å› ä¸ºæˆ‘ä»¬åªéœ€è¦å½“å‰ç»„ä»¶æ›´æ–°ï¼Œå…¶ä»–ç»„ä»¶ä¸éœ€è¦åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ scheduleUpdateOnFiber æ—¶åªéœ€è¦æäº¤å½“å‰ fiber å³å¯

```typescript

function dispatchReducerAction(fiber: Fiber, hook: Hook, reducer, action) {
	hook.memoizedState = reducer(hook.memoizedState)
	fiber.alternate = { ...fiber }
	// å› ä¸ºæˆ‘ä»¬åªæ›´æ–°è¿™ä¸€ä¸ª fiber ç»„ä»¶ï¼Œä¸èƒ½å½±å“å…¶ä»–ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦å°† sibling è®¾ç½®ä¸º nullï¼Œé¿å…åç»­ç»„ä»¶è¢«é‡å¤æ¸²æŸ“
	fiber.sibling = null
	// æ›´æ–°å½“å‰ fiber
	scheduleUpdateOnFiber(fiber)
}
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† useReducer çš„åŠŸèƒ½äº†ã€‚åœ¨è¿™ä¸ªåŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬å®ç°äº† fiberã€dom çš„å¤ç”¨å’Œæ›´æ–°

## å®ç° useState

å®ç°å®Œ useReducerï¼Œä¼šå‘ç° useState çš„å®ç°æ˜¯å·®ä¸å¤šçš„ï¼ŒåŒºåˆ«å°±åœ¨äº useState æ²¡æœ‰ reducer å‚æ•°ï¼Œå¹¶åœ¨ä½¿ç”¨ dispatch æ—¶ä¼šå°†æ–°çš„å€¼ä¼ é€’è¿‡æ¥ï¼Œæˆ‘ä»¬å¯¹ useReducer ç¨ä½œä¿®æ”¹åå…¼å®¹å®ç° useState

```typescript
export function useState(initalState) {
	// å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ reduce ï¼Œæ‰€ä»¥ä¼  null
	return useReducer(null, initalState)
}

function dispatchReducerAction(fiber: Fiber, hook: Hook, reducer, action) {
	// é€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰ reducerï¼Œæ¥å†³å®š state çš„å€¼æ˜¯ reducer æ‰§è¡Œçš„ç»“æœï¼Œæ¥è¿˜æ˜¯æ ¹æ®ä¼ è¿›æ¥çš„å‚æ•°
	// å…¶å®å°±æ˜¯åˆ¤æ–­æ˜¯ useReducer è¿˜æ˜¯ useState
	hook.memoizedState = reducer ? reducer(hook.memoizedState) : action
	fiber.alternate = { ...fiber }
	fiber.sibling = null
	scheduleUpdateOnFiber(fiber)
}
```

## ä¼˜åŒ– useReducer
åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨ useReducer æ—¶ï¼Œå¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·ä½¿ç”¨çš„ï¼Œåœ¨è°ƒç”¨ dispatch æ—¶ä¹Ÿéœ€è¦æ”¯æŒå‚æ•°ã€‚
```typescript
function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    default:
      throw new Error();
  }
}

function FunctionComponent(props) {

  const [data, setData] = useReducer(reducer, { count: 0 })

  return (
    <div className='function'>
      <div>{ data.count }</div>
      <button onClick={ () => setData({ type: 'increment' }) }>data.count + 1</button>
      <button onClick={ () => setData({ type: 'decrement' }) }>data.count - 1</button>
    </div>
  )
}
```

æˆ‘ä»¬åªéœ€è¦å°† `dispatch` ä¸­çš„ `action` ä¼ å…¥åˆ°`reducer`ä¸­å³å¯
```typescript
function dispatchReducerAction(fiber: Fiber, hook: Hook, reducer, action) {
	// é€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰ reducerï¼Œæ¥å†³å®š state çš„å€¼æ˜¯ reducer æ‰§è¡Œçš„ç»“æœï¼Œæ¥è¿˜æ˜¯æ ¹æ®ä¼ è¿›æ¥çš„å‚æ•°
	// å…¶å®å°±æ˜¯åˆ¤æ–­æ˜¯ useReducer è¿˜æ˜¯ useState
	hook.memoizedState = reducer ? reducer(hook.memoizedState, action) : action
	fiber.alternate = { ...fiber }
	fiber.sibling = null
	scheduleUpdateOnFiber(fiber)
}
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†`useReducer`å’Œ`useState`ï¼Œæä¾›äº†æ›´æ–°é¡µé¢æ•°æ®çš„èƒ½åŠ›ã€‚
> [ğŸ‘‰ ä»“åº“åœ°å€](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fjerry-lllman%2Fmini-react)ï¼Œè·ªæ±‚æ‚¨å¸®å¿™ç‚¹ä¸ª ğŸŒŸğŸŒŸï¼Œè°¢è°¢å•¦ï½
> PSï¼šæœ¬èŠ‚ä»£ç åœ¨ v0.0.3 åˆ†æ”¯

